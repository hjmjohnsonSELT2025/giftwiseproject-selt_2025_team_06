<!DOCTYPE html>
<html>
<head>
  <title>Your Gifts | GiftWise</title>
  <%= stylesheet_link_tag "default", "data-turbo-track": "reload" %>
</head>

<body>
<div class="login-container">
  <h1>All Gifts</h1>
  <div class="gift-top-buttons">
    <div class="gift-dropdown">
      <details class="dropdown">
        <summary class="add-gift-btn gift-search-button">Sort ▼</summary>

        <div class="dropdown-menu">
          <%= link_to "Name (A–Z)", gifts_path(sort: "name"), class: "dropdown-item" %>
          <%= link_to "Price (Low → High)", gifts_path(sort: "price"), class: "dropdown-item" %>
          <%= link_to "Date Added (Newest)", gifts_path(sort: "date"), class: "dropdown-item" %>
        </div>
      </details>
    </div>

    <div class="gift-dropdown">
      <details class="dropdown">
        <summary class="add-gift-btn gift-search-button">View ▼</summary>

        <div class="dropdown-menu">
          <%= link_to "Wishlisted", gifts_path(view: "wishlisted"), class: "dropdown-item" %>
          <%= link_to "Ignore",     gifts_path(view: "ignore"),     class: "dropdown-item" %>
          <%= link_to "All Gifts",  gifts_path,                     class: "dropdown-item" %>
        </div>
      </details>
    </div>

    <%= form_with url: gifts_path, method: :get, local: true, class: "gift-search-form" do |f| %>
      <!-- keep sort/view when searching -->
      <%= hidden_field_tag :sort, params[:sort] if params[:sort].present? %>
      <%= hidden_field_tag :view, params[:view] if params[:view].present? %>

      <%= f.text_field :search,
                       value: params[:search],
                       placeholder: "Search gifts...",
                       class: "gift-search-input" %>

      <%= f.submit "Search", class: "add-gift-btn gift-search-button" %>
    <% end %>
  </div>
  <br />

  <% if @gifts.empty? %>
    <p>No gifts have been added yet.</p>
  <% else %>

    <div class="gift-grid">
      <% @gifts.each do |gift| %>
        <div class="gift-card">
          <div class="gift-header">
            <h2 class="gift-title"><%= gift.name %></h2>

            <div class="gift-actions">
              <% is_wishlisted = @user_statuses[gift.id] == @wishlisted_status&.id %>

              <%= button_to toggle_wishlisted_gift_path(gift.id),
                            method: :post,
                            class: "star-button action-btn" do %>
                <% if is_wishlisted %>
                  <span class="gift-star filled">★</span>
                <% else %>
                  <span class="gift-star">☆</span>
                <% end %>
              <% end %>

              <% is_ignored = @user_statuses[gift.id] == @ignored_status&.id %>

              <%= button_to toggle_ignored_gift_path(gift.id),
                            method: :post,
                            class: "x-button action-btn" do %>
                <% if is_ignored %>
                  <span class="gift-x filled">✘</span>
                <% else %>
                  <span class="gift-x">✘</span>
                <% end %>
              <% end %>
            </div>
          </div>

          <% if gift.price.present? %>
            <p class="gift-price"><%= number_to_currency(gift.price) %></p>
          <% end %>

          <p class="gift-date">Added on <%= gift.created_at.strftime("%Y-%m-%d") %></p>

          <div class="gift-link">
            <% if gift.purchase_url.present? %>
              <a href="<%= gift.purchase_url %>" target="_blank">View Item</a>
            <% else %>
              <span class="no-url">No URL Provided</span>
            <% end %>
          </div>
        </div>

    <% end %>
    </div>

  <% end %>
  <br />
  <div class="add-gift-btn-container">
    <a href="<%= new_gift_path %>" class="add-gift-btn">+ Add New Gift</a>
  </div>

</div>
</body>
</html>
