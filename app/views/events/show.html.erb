<div class="event-wrapper">
  <div class="event-card">

    <h1>View Event</h1>

    <% if flash[:alert] %>
      <p class="alert"><%= flash[:alert] %></p>
    <% elsif flash[:notice] %>
      <p class="notice"><%= flash[:notice] %></p>
    <% end %>

    <div>
      <%= link_to "Back to All Events", events_path, class: "btn btn-default" %>
    </div>

    <div class="event-detail">
      <p><strong>Host:</strong> <%= @event.host.username%></p>
      <p><strong>Date:</strong> <%= @event.event_date %></p>
      <p><strong>Location:</strong> <%= @event.location %></p>
      <p><strong>Budget:</strong> <%= @event.budget %></p>
      <p><strong>Theme:</strong> <%= @event.theme %></p>
    </div>

    <h2>Attendees</h2>
    <div class="attendee-list-scroll">
      <% accepted_invites = @event.invites.where(status: "accepted") %>

      <% if accepted_invites.empty? %>
        <p class="no-attendees">  No one is coming yet.</p>
      <% else %>
        <ul class="attendee-list">
          <% accepted_invites.each do |invite| %>
            <% attendee = invite.user %>
            <% next if attendee.nil? %>
            <li id="attendee-<%= attendee.username %>" class="attendee-item">
              <span><strong><%= attendee.username %></strong> is going</span>

              <% if current_user.id == @event.user_id %>
                <%= button_to "Remove Attendee",
                              remove_attendee_event_path(@event, user_id: attendee.id),
                              method: :delete,
                              local: true,
                              class: "btn btn-danger" %>
              <% end %>
            </li>
          <% end %>
        </ul>
      <% end %>
    </div>

    <div class="invite-container">
      <h3>Invite Someone!</h3>
      <%= form_tag invite_event_path(@event), method: :post, class: "invite-form" do %>
        <input type="text"
               name="username"
               placeholder="Enter username..."
               class="invite-input" />
        <button type="submit" class="invite-button">Invite</button>
      <% end %>
    </div>

    <div class="invite-container">
      <h3>Invite a Friend</h3>

      <% if @friends_not_coming.any? %>
        <%= form_with url: invite_friends_event_path(@event),
                      method: :post,
                      local: true,
                      class: "invite-form" do %>

          <div class="friend-scroll">
            <% @friends_not_coming.each do |friend| %>
              <label class="friend-row">
                <%= check_box_tag "friend_ids[]", friend.id %>
                <span><%= friend.username %></span>
              </label>
            <% end %>
          </div>

          <button type="submit" class="invite-button">
            Invite Selected Friends
          </button>
        <% end %>
      <% else %>
        <p class="no-attendees">All your friends are already invited or attending.</p>
      <% end %>
    </div>



  </div>
</div>
<style>
    .friend-scroll {
        max-height: 140px;
        overflow-y: auto;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 8px;
        margin-bottom: 10px;
    }

    .friend-row {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 0;
        cursor: pointer;
    }
</style>